<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Document</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>
    <h1>nello world</h1>
    <form>
            <div class="form-row align-items-center">
              <div class="col-auto">
                <label class="sr-only" for="inlineFormInput">Name</label>
                <input type="text" class="form-control mb-2" id="nm" placeholder="Jane Doe">
              </div>
              <div class="col-auto">
                <label class="sr-only" for="inlineFormInputGroup">Username</label>
                <div class="input-group mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text">@</div>
                  </div>
                  <input type="text" class="form-control" id="pwd" placeholder="Username">
                </div>
              </div>

              <div class="col-auto">
                <button type="button" class="btn btn-primary mb-2" id='submit'>Submit</button>
              </div>
            </div>
          </form>
        <div class='col-sm-8' >
            <ul class='col-sm-12' id='ul'>
                <li>用户名:xxx 密码:xxx</li>
            </ul>
        </div>
    </div>
    <script>
        (function(){
            let str='';
            function a(name,age,id){
              return `<li>用户名:${name} 密码:${age}<input data-index=${id} class='btn btn-warning pull-right' type='button' value='delete'/></li>`;
            }
            fetch('/user',{method:'GET'}).then((data)=>{
                return data.text();
                
            }).then((data)=>{
              JSON.parse(data).forEach((p)=>{
              str+=a(p.name,p.age,p.id);
            }
            
            
            )
            ul.innerHTML=str;
        })

         const submit=document.getElementById('submit');
        submit.onclick=function(){
          console.log(nm.value,pwd.value)
            fetch('/user',{
              method:'POST',
              body:JSON.stringify({'name':nm.value,'age':pwd.value})
            }).then((data)=>{
                return data.json()
            }).then((data)=>{
              let temp=a(data.name,data.age,data.id);
              let odiv=document.createElement('div');
              odiv.innerHTML=temp;
              ul.appendChild(odiv.firstElementChild);

            })
          }


          ul.onclick=function(ev){
            console.log(ev.target);
            if(ev.target.nodeName==='INPUT'){
              fetch('/user',{
                method:'DELETE',
                body:JSON.stringify({'id':ev.target.dataset.id})
              }).then((data)=>{
                console.log(data);
                  ul.removeChild(ev.target.parentNode);
              })
            }
          }
      })()

     

    </script>
</body>
</html>